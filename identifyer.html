<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Identification</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen&display=swap');

        body {
            font-family: 'Silkscreen', cursive;
            background-color: skyblue;
            color: forestgreen;
            text-align: center;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .button {
            font-family: 'Silkscreen', cursive;
            border: 6px solid forestgreen;
            background: beige;
            color: forestgreen;
            padding: 12px;
            cursor: pointer;
            font-size: 18px;
            margin: 5px;
            box-shadow: 4px 4px forestgreen;
        }
        table {
            border-collapse: collapse;
            width: 90%;
            margin-top: 20px;
            color: forestgreen;
            background-color: beige;
            border: 8px solid forestgreen;
            box-shadow: 6px 6px forestgreen;
        }
        thead {
            background-color: beige;
        }
        th, td {
            font-family: 'Silkscreen', cursive;
            border: 6px solid forestgreen;
            padding: 12px;
            text-align: center;
            background-color: beige;
        }
        th:nth-child(2), td:nth-child(2) {
            width: 10px;
        }
        input, button {
            font-family: 'Silkscreen', cursive;
            background: #9CAF88;
            color: forestgreen;
            border: 6px solid forestgreen;
            padding: 8px;
            box-shadow: 3px 3px forestgreen;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Form Table -->
        <table>
            <thead>
                <tr>
                    <th>USERNAME</th>
                    <th></th> <!-- Empty column for spacing -->
                    <th>SPECIES NAME</th>
                    <th>DATE</th>
                    <th>PLACE</th>
                    <th>SUBMIT</th>
                </tr>
            </thead>
            <tbody id="species-records">
                <tr>
                    <td><input type="text" placeholder="Enter username"></td>
                    <td></td> <!-- Empty column remains for spacing -->
                    <td><input type="text" placeholder="Species you think it is"></td>
                    <td><input type="text" class="date" placeholder="Enter manually"> <button class="button date-btn" onclick="getDate(this)">USE DEVICE DATE</button></td>
                    <td><input type="text" class="place" placeholder="Enter manually"> <button class="button location-btn" onclick="getLocation(this)">USE DEVICE LOCATION</button></td>
                    <td><button class="button submit-btn">SUBMIT</button></td>
                </tr>
            </tbody>
        </table>
        <button class="button add-row">ADD ROW</button>
        <button class="button" onclick="window.location.href='map.html';">GO STRAIGHT TO MAP</button>
        
        <!-- Species List Table -->
        
        <table id="speciesTable">
            <thead>
                <tr>
                    <th>Animal</th>
                    <th>Plant</th>
                    <th>Fungi</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be inserted here by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const table = document.getElementById("species-records");
            const addRowBtn = document.querySelector(".add-row");

            // Event listener for submit button
            table.addEventListener("click", function(event) {
                if (event.target.classList.contains("submit-btn")) {
                    console.log("Submit button clicked!");

                    const row = event.target.closest("tr");
                    const username = row.cells[0].querySelector("input").value.trim() || "Unknown";
                    const species = row.cells[2].querySelector("input").value.trim() || "Not specified";
                    const date = row.cells[3].querySelector("input").value.trim() || "No date";
                    const place = row.cells[4].querySelector("input").value.trim() || "Unknown location";

                    const record = { username, species, date, place };
                    console.log("Submitting record:", record);

                    fetch("https://script.google.com/macros/s/AKfycbwsG06dGQsqT_22efWAZn9RtadK3JKAoINByzP1KLosycvC-Mv2q0S6Se4fdA84tF9pTw/exec", {
                        method: "POST",
                        mode: "no-cors",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(record)
                    })
                    .then(() => alert("Data submitted successfully!"))
                    .catch(error => console.error("Error:", error));
                }
            });

            // Add new row function
            addRowBtn.addEventListener("click", function() {
                console.log("Adding a new row");
                const newRow = document.createElement("tr");

                newRow.innerHTML = `
                    <td><input type="text" placeholder="Enter username"></td>
                    <td></td>
                    <td><input type="text" placeholder="Species you think it is"></td>
                    <td>
                        <input type="text" class="date" placeholder="Enter manually">
                        <button class="button date-btn" onclick="getDate(this)">USE DEVICE DATE</button>
                    </td>
                    <td>
                        <input type="text" class="place" placeholder="Enter manually">
                        <button class="button location-btn" onclick="getLocation(this)">USE DEVICE LOCATION</button>
                    </td>
                    <td><button class="button submit-btn">SUBMIT</button></td>
                `;

                // Apply the same styles as the first row
                newRow.style.border = "6px solid forestgreen";
                newRow.style.backgroundColor = "beige";
                table.appendChild(newRow);
            });

            // Function to get the current date
            window.getDate = function(button) {
                button.previousElementSibling.value = new Date().toISOString().split("T")[0];
            };

            // Function to get the device location
            window.getLocation = function(button) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        button.previousElementSibling.value = `Lat: ${position.coords.latitude}, Lon: ${position.coords.longitude}`;
                    });
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            };

            // CSV data (your full CSV data goes here)
            const csvData = `Animal,Plant,Fungi
Alpine Newt,Bluebell,Death Cap Mushroom
American mink,Bird’s-foot Trefoil,Fly Agaric Mushroom
Balearic Shearwater,Blackthorn,Jelly Ear Fungus
Banded Demoiselle,Bluebell,Orange Peel Fungus
bank vole,Bramble,Panther Cap Mushroom
barbastelle bat,Broom,Scarlet Elf Cup Fungus
Barn Owl,Bugle,Shaggy Inkcap Mushroom
bat,Cat’s-ear,Stinkhorn Fungus
Bearded Tit,Common Bistort,
Beautiful Demoiselle,Common Blackbird,
Bechsteins bat,Common Blue Butterfly,
bottlenose dolphin,Common Centaury,
Brambling,Common Chickweed,
Brandts bat,Common Dog Violet,
Broad-bodied Chaser,Common Fleabane,
brown long-eared bat,Common Hawthorn,
brown rat,Common Hemp-nettle,
Buff-tailed Bumblebee,Common Honeysuckle,
Carrion Crow,Common Knapweed,
Cave Spider,Common Mallow,
Chaffinch,Common Milkwort,
Chinese water deer,Common Mouse-ear,
Coal Tit,Common Poppy,
Collared Dove,Common Ragwort,
Comma Butterfly,Common Spotted Orchid,
Common Blackbird,Common Toadflax,
Common Blue Butterfly,Common Valerian,
Common Crab Spider,Common Water-crowfoot,
Common Crossbill,Corn Bunting,
Common Darter Dragonfly,Corn Marigold,
Common Dolphin,Cornflower,
Common Fox Spider,Cuckooflower,
Common Frog,Daisy,
Common Kingfisher,Dandelion,
Common Linnet,Dogwood,
Common Lizard,Elder,
Common Moorhen,English Oak,
Common Redshank,Eyebright,
Common Sandpiper,Field Scabious,
common shrew,Foxglove,
Common Snipe,Germander Speedwell,
Common Swift,Great Burnet,
Common Toad,Great Willowherb,
common vole,Greater Knapweed,
Common Wood Pigeon,Greater Plantain,
Cormorant,Greater Stitchwort,
Corncrake,Green Alkanet,
coypu,Harebell,
Cuckoo,Hedge Bindweed,
deer family,Herb Robert,
Devils Coach Horse,Hogweed,
domestic cat,Lady’s Bedstraw,
domestic ferret,Lesser Celandine,
domestic goat,Marsh Cinquefoil,
Dusky Warbler,Marsh Horsetail,
Edible Frog,Marsh Violet,
elephants,Marsh Woundwort,
Emperor Dragonfly,Marsh-marigold,
Eurasian beaver,Meadow Buttercup,
Eurasian Blackbird,Meadow Crane’s-bill,
Eurasian Curlew,Meadow Pipit,
Eurasian Magpie,Meadow Vetchling,
Eurasian water shrew,Meadowsweet,
Eurasian Wren,Primrose,
European Adder,Purple Loosestrife,
European badger,Red Campion,
European Garden Spider,Red Dead-nettle,
European Goldfinch,Sea Holly,
European Greenfinch,Selfheal,
European hare,Silver Birch,
European hedgehog,Silverweed,
European mole,Sneezewort,
European Nightjar,Spearmint,
European otter,Stinging Nettle,
European polecat,Thrift (Sea Pink),
European rabbit,Water Mint,
European Robin,White Dead-nettle,
European Starling,Wild Angelica,
European Stonechat,Wild Basil,
European water vole,Wild Carrot,
European wildcat,Wild Clary,
fallow deer,Wild Garlic (Crow Garlic),
False Black Widow Spider,Wild Garlic (Ramsons),
Fen Raft Spider,Wild Marjoram,
ferret_polecat hybrid,Wild Pansy (Heartsease),
field vole,Wild Parsnip,
Firecrest,Wild Radish,
Foxglove,Wild Strawberry,
Goldfinch,Wild Thyme,
Grass Snake,Wood Anemone,
Great Crested Grebe,Wood Avens,
Great Crested Newt,Wood Sorrel,
Great Spotted Woodpecker,Yarrow,
Great Tit,Yellow Archangel,
greater horseshoe bat,Yellow Flag Iris,
greater white-toothed shrew,Yellow Rattle,
Grey Heron,,
grey seal,,
Hammock-web Spider,,
harbour porpoise,,
harbour seal,,
harvest mouse,,
hazel dormouse,,
Hen Harrier,,
Holly Blue Butterfly,,
house mouse,,
House Sparrow,,
humpback whale,,
Irish hare,,
Jackdaw,,
Kestrel,,
Lace Web Spider,,
Large Red Damselfly,,
Leislers bat,,
lesser horseshoe bat,,
lesser white-toothed shrew,,
Little Egret,,
Little Owl,,
Little Tern,,
long-eared bats,,
Long-tailed Tit,,
Mallard Duck,,
mammals,,
Marmalade Hoverfly,,
Marsh Frog,,
Marsh Harrier,,
Meadow Pipit,,
mice and rats,,
mice genus,,
Migrant Hawker Dragonfly,,
minke whale,,
mountain hare,,
mouse-eared bats,,
Mute Swan,,
Nathusius pipistrelle,,
Natterer's bat,,
Natterjack Toad,,
noctule bat,,
noctule bats,,
noctule_serotine bat group,,
Northern Lapwing,,
Northern Wheatear,,
oceanic dolphins,,
Painted Lady Butterfly,,
Pallas's Warbler,,
Palmate Newt,,
Peacock Butterfly,,
Peregrine Falcon,,
Pied Wagtail,,
pine marten,,
pipistrelle bat genus,,
Pomarine Skua,,
pygmy shrew,,
Raft Spider,,
Red Admiral Butterfly,,
red deer,,
red fox,,
Red Kite,,
red squirrel,,
Red-backed Shrike,,
Red-flanked Bluetail,,
red-necked wallaby,,
Red-tailed Bumblebee,,
Red-throated Diver,,
Redwing,,
Reed Bunting,,
Reeves's muntjac,,
Ring Ouzel,,
Rissos dolphin,,
roe deer,,
Rook,,
Roseate Tern,,
Running Crab Spider,,
Rustic Bunting,,
Sand Lizard,,
Sand Martin,,
Serin,,`;

            // Function to parse CSV and populate the species list table
            function populateTable(csvData) {
                const table = document.getElementById('speciesTable');
                const rows = csvData.trim().split('\n');
                
                // Iterate through each CSV row
                rows.forEach((row, index) => {
                    if (index === 0) return; // Skip the header row
                    const columns = row.split(',');
                    const tr = document.createElement('tr');
                    
                    // Create a cell for Animal, Plant, and Fungi
                    columns.forEach((col, idx) => {
                        const td = document.createElement('td');
                        const speciesName = col.trim();
                        td.textContent = speciesName;
                        
                        // Insert the image for each species
                        if (speciesName) {
                            const img = document.createElement('img');
                            img.src = `https://boobalootoo.github.io/simplifiedgame/images/${speciesName}.png`;
                            img.alt = speciesName;
                            img.style.width = "100px"; // Resize images to fit in table cells
                            img.style.height = "100px";
                            td.appendChild(img);
                        }

                        tr.appendChild(td);
                    });
                    
                    table.appendChild(tr);
                });
            }

            // Call the function to populate the table
            populateTable(csvData);
        });
    </script>
</body>
</html>
